<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Feature Extraction · JLdb</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">JLdb</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../basics/">Basics</a></li><li><a class="tocitem" href="../operations/">Table Operations</a></li><li><a class="tocitem" href="../joins/">Joins</a></li><li><a class="tocitem" href="../onlinestats/">OnlineStats Integration</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../missing_values/">Missing Values</a></li><li><a class="tocitem" href="../out_of_core/">Out-of-core processing</a></li><li class="is-active"><a class="tocitem" href>Feature Extraction</a><ul class="internal"><li><a class="tocitem" href="#ML.schema"><span>ML.schema</span></a></li><li><a class="tocitem" href="#Split-schema-into-input-and-output"><span>Split schema into input and output</span></a></li><li><a class="tocitem" href="#Extracting-feature-matrix"><span>Extracting feature matrix</span></a></li><li><a class="tocitem" href="#Learning"><span>Learning</span></a></li><li><a class="tocitem" href="#Prediction"><span>Prediction</span></a></li></ul></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Feature Extraction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Feature Extraction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Heptazhou/JLdb.jl/blob/master/docs/src/ml.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Feature-Extraction"><a class="docs-heading-anchor" href="#Feature-Extraction">Feature Extraction</a><a id="Feature-Extraction-1"></a><a class="docs-heading-anchor-permalink" href="#Feature-Extraction" title="Permalink"></a></h1><p>Machine learning models are composed of mathematical operations on matrices of numbers. However, data in the real world is often in tabular form containing more than just numbers. Hence, the first step in applying machine learning is to turn such tabular non-numeric data into a matrix of numbers. Such matrices are called &quot;feature matrices&quot;. JuliaDB contains an <code>ML</code> module which has helper functions to extract feature matrices.</p><p>In this document, we will turn the <a href="https://www.kaggle.com/c/titanic">titanic dataset from Kaggle</a> into numeric form and apply a machine learning model on it.</p><pre><code class="language-julia hljs">using JuliaDB

download(&quot;https://raw.githubusercontent.com/agconti/&quot;*
          &quot;kaggle-titanic/master/data/train.csv&quot;, &quot;train.csv&quot;)

train_table = loadtable(&quot;train.csv&quot;, escapechar=&#39;&quot;&#39;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Table with 891 rows, 9 columns:
Columns:
#  colname      type
───────────────────────────────────────
1  PassengerId  Int64
2  Survived     Int64
3  Pclass       Int64
4  Sex          String
5  Age          Union{Missing, Float64}
6  SibSp        Int64
7  Parch        Int64
8  Fare         Float64
9  Embarked     String</code></pre><h2 id="ML.schema"><a class="docs-heading-anchor" href="#ML.schema">ML.schema</a><a id="ML.schema-1"></a><a class="docs-heading-anchor-permalink" href="#ML.schema" title="Permalink"></a></h2><p>Schema is a programmatic description of the data in each column. It is a dictionary which maps each column (by name) to its schema type (mainly <code>Continuous</code>, and <code>Categorical</code>).</p><ul><li><code>ML.Continuous</code>: data is drawn from the real number line (e.g. Age)</li><li><code>ML.Categorical</code>: data is drawn from a fixed set of values (e.g. Sex)</li></ul><p><code>ML.schema(train_table)</code> will go through the data and infer the types and distribution of data. Let&#39;s try it without any arguments on the titanic dataset:</p><pre><code class="language-julia hljs">using JuliaDB: ML

ML.schema(train_table)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Any} with 12 entries:
  :SibSp       =&gt; Continous(μ=0.5230078563411893, σ=1.1027434322934322)
  :Embarked    =&gt; nothing
  :PassengerId =&gt; Continous(μ=446.0, σ=257.3538420152301)
  :Cabin       =&gt; nothing
  :Age         =&gt; Maybe{Continuous}(Continous(μ=29.69911764705884, σ=14.5264973…
  :Survived    =&gt; Continous(μ=0.3838383838383839, σ=0.4865924542648576)
  :Parch       =&gt; Continous(μ=0.3815937149270483, σ=0.8060572211299485)
  :Pclass      =&gt; Continous(μ=2.3086419753086447, σ=0.8360712409770491)
  :Ticket      =&gt; nothing
  :Sex         =&gt; nothing
  :Name        =&gt; nothing
  :Fare        =&gt; Continous(μ=32.20420796857465, σ=49.693428597180855)</code></pre><p>Here is how the schema was inferred:</p><ul><li>Numeric fields were inferred to be <code>Continuous</code>, their mean and standard deviations were computed. This will later be used in normalizing the column in the feature matrix using the formula <code>((value - mean) / standard_deviation)</code>. This will bring all columns to the same &quot;scale&quot; making the training more effective.</li><li>Some string columns are inferred to be <code>Categorical</code> (e.g. Sex, Embarked) - this means that the column is a <a href="https://github.com/JuliaComputing/PooledArrays.jl">PooledArray</a>, and is drawn from a small &quot;pool&quot; of values. For example Sex is either &quot;male&quot; or &quot;female&quot;; Embarked is one of &quot;Q&quot;, &quot;S&quot;, &quot;C&quot; or &quot;&quot;</li><li>Some string columns (e.g. Name) get the schema <code>nothing</code> – such columns usually contain unique identifying data, so are not useful in machine learning.</li><li>The age column was inferred as <code>Maybe{Continuous}</code> – this means that there are missing values in the column. The mean and standard deviation computed are for the non-missing values.</li></ul><p>You may note that <code>Survived</code> column contains only 1s and 0s to denote whether a passenger survived the disaster or not. However, our schema inferred the column to be <code>Continuous</code>. To not be overly presumptive <code>ML.schema</code> will assume all numeric columns are continuous by default. We can give the hint that the Survived column is categorical by passing the <code>hints</code> arguemnt as a dictionary of column name to schema type. Further, we will also treat <code>Pclass</code> (passenger class) as categorical and suppress <code>Parch</code> and <code>SibSp</code> fields.</p><pre><code class="language-julia hljs">sch = ML.schema(train_table, hints=Dict(
        :Pclass =&gt; ML.Categorical,
        :Survived =&gt; ML.Categorical,
        :Parch =&gt; nothing,
        :SibSp =&gt; nothing,
        :Fare =&gt; nothing,
        )
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Any} with 12 entries:
  :SibSp       =&gt; nothing
  :Embarked    =&gt; nothing
  :PassengerId =&gt; Continous(μ=446.0, σ=257.3538420152301)
  :Cabin       =&gt; nothing
  :Age         =&gt; Maybe{Continuous}(Continous(μ=29.69911764705884, σ=14.5264973…
  :Survived    =&gt; Categorical([0, 1])
  :Parch       =&gt; nothing
  :Pclass      =&gt; Categorical([3, 1, 2])
  :Ticket      =&gt; nothing
  :Sex         =&gt; nothing
  :Name        =&gt; nothing
  :Fare        =&gt; nothing</code></pre><h2 id="Split-schema-into-input-and-output"><a class="docs-heading-anchor" href="#Split-schema-into-input-and-output">Split schema into input and output</a><a id="Split-schema-into-input-and-output-1"></a><a class="docs-heading-anchor-permalink" href="#Split-schema-into-input-and-output" title="Permalink"></a></h2><p>In a machine learning model, a subset of fields act as the input to the model, and one or more fields act as the output (predicted variables). For example, in the titanic dataset, you may want to predict whether a person will survive or not. So &quot;Survived&quot; field will be the output column. Using the <code>ML.splitschema</code> function, you can split the schema into input and output schema.</p><pre><code class="language- hljs">input_sch, output_sch = ML.splitschema(sch, :Survived)</code></pre><h2 id="Extracting-feature-matrix"><a class="docs-heading-anchor" href="#Extracting-feature-matrix">Extracting feature matrix</a><a id="Extracting-feature-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-feature-matrix" title="Permalink"></a></h2><p>Once the schema has been created, you can extract the feature matrix according to the given schema using <code>ML.featuremat</code>:</p><pre><code class="language- hljs">train_input = ML.featuremat(input_sch, train_table)</code></pre><pre><code class="language- hljs">train_output = ML.featuremat(output_sch, train_table)</code></pre><h2 id="Learning"><a class="docs-heading-anchor" href="#Learning">Learning</a><a id="Learning-1"></a><a class="docs-heading-anchor-permalink" href="#Learning" title="Permalink"></a></h2><p>Let us create a simple neural network to learn whether a passenger will survive or not using the <a href="https://fluxml.github.io/">Flux</a> framework.</p><p><code>ML.width(schema)</code> will give the number of features in the <code>schema</code> we will use this in specifying the model size:</p><pre><code class="language- hljs">using Flux

model = Chain(
  Dense(ML.width(input_sch), 32, relu),
  Dense(32, ML.width(output_sch)),
  softmax)

loss(x, y) = Flux.mse(model(x), y)
opt = Flux.ADAM(Flux.params(model))
evalcb = Flux.throttle(() -&gt; @show(loss(first(data)...)), 2);</code></pre><p>Train the data in 10 iterations</p><pre><code class="language- hljs">data = [(train_input, train_output)]
for i = 1:10
  Flux.train!(loss, data, opt, cb = evalcb)
end</code></pre><p><code>data</code> given to the model is a vector of batches of input-output matrices. In this case we are training with just 1 batch.</p><h2 id="Prediction"><a class="docs-heading-anchor" href="#Prediction">Prediction</a><a id="Prediction-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction" title="Permalink"></a></h2><p>Now let&#39;s load some testing data to use the model we learned to predict survival.</p><pre><code class="language- hljs">
download(&quot;https://raw.githubusercontent.com/agconti/&quot;*
          &quot;kaggle-titanic/master/data/test.csv&quot;, &quot;test.csv&quot;)

test_table = loadtable(&quot;test.csv&quot;, escapechar=&#39;&quot;&#39;)

test_input = ML.featuremat(input_sch, test_table) ;</code></pre><p>Run the model on one observation:</p><pre><code class="language- hljs">model(test_input[:, 1])</code></pre><p>The output has two numbers which add up to 1: the probability of not surviving vs that of surviving. It seems, according to our model, that this person is unlikely to survive on the titanic.</p><p>You can also run the model on all observations by simply passing the whole feature matrix to <code>model</code>.</p><pre><code class="language- hljs">model(test_input)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../out_of_core/">« Out-of-core processing</a><a class="docs-footer-nextpage" href="../tutorial/">Tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Tuesday 12 April 2022 06:00">Tuesday 12 April 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
