<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · JLdb</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">JLdb</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../basics/">Basics</a></li><li><a class="tocitem" href="../operations/">Table Operations</a></li><li><a class="tocitem" href="../joins/">Joins</a></li><li><a class="tocitem" href="../onlinestats/">OnlineStats Integration</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../missing_values/">Missing Values</a></li><li><a class="tocitem" href="../out_of_core/">Out-of-core processing</a></li><li><a class="tocitem" href="../ml/">Feature Extraction</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Getting-the-data"><span>Getting the data</span></a></li><li><a class="tocitem" href="#Loading-the-data"><span>Loading the data</span></a></li><li><a class="tocitem" href="#Filtering-the-data"><span>Filtering the data</span></a></li><li><a class="tocitem" href="#Select:-pick-columns-by-name"><span>Select: pick columns by name</span></a></li><li><a class="tocitem" href="#Applying-several-operations"><span>Applying several operations</span></a></li><li><a class="tocitem" href="#Reorder-rows"><span>Reorder rows</span></a></li><li><a class="tocitem" href="#Apply-a-function-row-by-row"><span>Apply a function row by row</span></a></li><li><a class="tocitem" href="#Add-new-variables"><span>Add new variables</span></a></li><li><a class="tocitem" href="#Reduce-variables-to-values"><span>Reduce variables to values</span></a></li><li><a class="tocitem" href="#Performance-tip"><span>Performance tip</span></a></li><li><a class="tocitem" href="#Window-functions"><span>Window functions</span></a></li><li><a class="tocitem" href="#Visualizing-your-data"><span>Visualizing your data</span></a></li><li><a class="tocitem" href="#Online-statistics"><span>Online statistics</span></a></li><li><a class="tocitem" href="#Interfacing-with-online-datasets"><span>Interfacing with online datasets</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Heptazhou/JLdb.jl/blob/master/docs/src/tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This is a port of a well known <a href="https://rpubs.com/justmarkham/dplyr-tutorial">tutorial</a> for the <a href="http://juliadb.org/latest/">JuliaDB</a> package. This tutorial is available as a Jupyter notebook <a href="https://github.com/piever/JuliaDBTutorial/blob/master/hflights.ipynb">here</a>.</p><h2 id="Getting-the-data"><a class="docs-heading-anchor" href="#Getting-the-data">Getting the data</a><a id="Getting-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-the-data" title="Permalink"></a></h2><p>The flights dataset for the tutorial is <a href="https://raw.githubusercontent.com/piever/JuliaDBTutorial/master/hflights.csv">here</a>.  Alternatively, run the following in Julia:</p><pre><code class="language-julia hljs">download(&quot;https://raw.githubusercontent.com/piever/JuliaDBTutorial/master/hflights.csv&quot;)</code></pre><h2 id="Loading-the-data"><a class="docs-heading-anchor" href="#Loading-the-data">Loading the data</a><a id="Loading-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-the-data" title="Permalink"></a></h2><p>Loading a csv file is straightforward with JuliaDB:</p><pre><code class="language-julia hljs">using JuliaDB

flights = loadtable(&quot;hflights.csv&quot;)</code></pre><p>Of course, replace the path with the location of the dataset you have just downloaded.</p><h2 id="Filtering-the-data"><a class="docs-heading-anchor" href="#Filtering-the-data">Filtering the data</a><a id="Filtering-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering-the-data" title="Permalink"></a></h2><p>In order to select only rows matching certain criteria, use the <code>filter</code> function:</p><pre><code class="language-julia hljs">filter(i -&gt; (i.Month == 1) &amp;&amp; (i.DayofMonth == 1), flights)</code></pre><p>To test if one of two conditions is verified:</p><pre><code class="language-julia hljs">filter(i -&gt; (i.UniqueCarrier == &quot;AA&quot;) || (i.UniqueCarrier == &quot;UA&quot;), flights)

# in this case, you can simply test whether the `UniqueCarrier` is in a given list:

filter(i -&gt; i.UniqueCarrier in [&quot;AA&quot;, &quot;UA&quot;], flights)</code></pre><h2 id="Select:-pick-columns-by-name"><a class="docs-heading-anchor" href="#Select:-pick-columns-by-name">Select: pick columns by name</a><a id="Select:-pick-columns-by-name-1"></a><a class="docs-heading-anchor-permalink" href="#Select:-pick-columns-by-name" title="Permalink"></a></h2><p>You can use the <code>select</code> function to select a subset of columns:</p><pre><code class="language-julia hljs">select(flights, (:DepTime, :ArrTime, :FlightNum))</code></pre><pre><code class="nohighlight hljs">Table with 227496 rows, 3 columns:
DepTime  ArrTime  FlightNum
───────────────────────────
1400     1500     428
1401     1501     428
1352     1502     428
1403     1513     428
1405     1507     428
1359     1503     428
1359     1509     428
1355     1454     428
1443     1554     428
1443     1553     428
1429     1539     428
1419     1515     428
⋮
1939     2119     124
556      745      280
1026     1208     782
1611     1746     1050
758      1051     201
1307     1600     471
1818     2111     1191
2047     2334     1674
912      1031     127
656      812      621
1600     1713     1597</code></pre><p>Let&#39;s select all columns between <code>:Year</code> and <code>:Month</code> as well as all columns containing &quot;Taxi&quot; or &quot;Delay&quot; in their name. <code>Between</code> selects columns between two specified extremes, passing a function filters column names by that function and <code>All</code> takes the union of all selectors (or all columns, if no selector is specified).</p><pre><code class="language-julia hljs">select(flights, All(Between(:Year, :DayofMonth), i -&gt; occursin(&quot;Taxi&quot;, string(i)), i -&gt; occursin(&quot;Delay&quot;, string(i))))</code></pre><pre><code class="nohighlight hljs">Table with 227496 rows, 7 columns:
Year  Month  DayofMonth  TaxiIn  TaxiOut  ArrDelay  DepDelay
────────────────────────────────────────────────────────────
2011  1      1           7       13       -10       0
2011  1      2           6       9        -9        1
2011  1      3           5       17       -8        -8
2011  1      4           9       22       3         3
2011  1      5           9       9        -3        5
2011  1      6           6       13       -7        -1
2011  1      7           12      15       -1        -1
2011  1      8           7       12       -16       -5
2011  1      9           8       22       44        43
2011  1      10          6       19       43        43
2011  1      11          8       20       29        29
2011  1      12          4       11       5         19
⋮
2011  12     6           4       15       14        39
2011  12     6           13      9        -10       -4
2011  12     6           4       12       -12       1
2011  12     6           3       9        -9        16
2011  12     6           3       10       -4        -2
2011  12     6           5       10       0         7
2011  12     6           5       11       -9        8
2011  12     6           4       9        4         7
2011  12     6           4       14       -4        -3
2011  12     6           3       9        -13       -4
2011  12     6           3       11       -12       0</code></pre><p>The same could be achieved more concisely using regular expressions:</p><pre><code class="language-julia hljs">select(flights, All(Between(:Year, :DayofMonth), r&quot;Taxi|Delay&quot;))</code></pre><h2 id="Applying-several-operations"><a class="docs-heading-anchor" href="#Applying-several-operations">Applying several operations</a><a id="Applying-several-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Applying-several-operations" title="Permalink"></a></h2><p>If one wants to apply several operations one after the other, there are two main approaches:</p><ul><li>nesting</li><li>piping</li></ul><p>Let&#39;s assume we want to select <code>UniqueCarrier</code> and <code>DepDelay</code> columns and filter for delays over 60 minutes. Since the <code>DepDelay</code> column has missing data, we also need to filter out <code>missing</code> values via <code>!ismissing</code>.  The nesting approach would be:</p><pre><code class="language-julia hljs">filter(i -&gt; !ismissing(i.DepDelay &gt; 60), select(flights, (:UniqueCarrier, :DepDelay)))</code></pre><pre><code class="nohighlight hljs">Table with 224591 rows, 2 columns:
UniqueCarrier  DepDelay
───────────────────────
&quot;AA&quot;           0
&quot;AA&quot;           1
&quot;AA&quot;           -8
&quot;AA&quot;           3
&quot;AA&quot;           5
&quot;AA&quot;           -1
&quot;AA&quot;           -1
&quot;AA&quot;           -5
&quot;AA&quot;           43
&quot;AA&quot;           43
⋮
&quot;WN&quot;           1
&quot;WN&quot;           16
&quot;WN&quot;           -2
&quot;WN&quot;           7
&quot;WN&quot;           8
&quot;WN&quot;           7
&quot;WN&quot;           -3
&quot;WN&quot;           -4
&quot;WN&quot;           0</code></pre><p>For piping, we&#39;ll use the excellent <a href="https://github.com/MikeInnes/Lazy.jl">Lazy</a> package.</p><pre><code class="language-julia hljs">import Lazy
Lazy.@as x flights begin
    select(x, (:UniqueCarrier, :DepDelay))
    filter(i -&gt; !ismissing(i.DepDelay &gt; 60), x)
end</code></pre><pre><code class="nohighlight hljs">Table with 224591 rows, 2 columns:
UniqueCarrier  DepDelay
───────────────────────
&quot;AA&quot;           0
&quot;AA&quot;           1
&quot;AA&quot;           -8
&quot;AA&quot;           3
&quot;AA&quot;           5
&quot;AA&quot;           -1
&quot;AA&quot;           -1
&quot;AA&quot;           -5
&quot;AA&quot;           43
&quot;AA&quot;           43
⋮
&quot;WN&quot;           1
&quot;WN&quot;           16
&quot;WN&quot;           -2
&quot;WN&quot;           7
&quot;WN&quot;           8
&quot;WN&quot;           7
&quot;WN&quot;           -3
&quot;WN&quot;           -4
&quot;WN&quot;           0</code></pre><p>where the variable <code>x</code> denotes our data at each stage. At the beginning it is <code>flights</code>, then it only has the two relevant columns and, at the last step, it is filtered.</p><h2 id="Reorder-rows"><a class="docs-heading-anchor" href="#Reorder-rows">Reorder rows</a><a id="Reorder-rows-1"></a><a class="docs-heading-anchor-permalink" href="#Reorder-rows" title="Permalink"></a></h2><p>Select <code>UniqueCarrier</code> and <code>DepDelay</code> columns and sort by <code>DepDelay</code>:</p><pre><code class="language-julia hljs">sort(flights, :DepDelay, select = (:UniqueCarrier, :DepDelay))</code></pre><pre><code class="nohighlight hljs">Table with 227496 rows, 2 columns:
UniqueCarrier  DepDelay
───────────────────────
&quot;OO&quot;           -33
&quot;MQ&quot;           -23
&quot;XE&quot;           -19
&quot;XE&quot;           -19
&quot;CO&quot;           -18
&quot;EV&quot;           -18
&quot;XE&quot;           -17
&quot;CO&quot;           -17
&quot;XE&quot;           -17
&quot;MQ&quot;           -17
&quot;XE&quot;           -17
&quot;DL&quot;           -17
⋮
&quot;US&quot;           missing
&quot;US&quot;           missing
&quot;US&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing
&quot;WN&quot;           missing</code></pre><p>or, in reverse order:</p><pre><code class="language-julia hljs">sort(flights, :DepDelay, select = (:UniqueCarrier, :DepDelay), rev = true)</code></pre><h2 id="Apply-a-function-row-by-row"><a class="docs-heading-anchor" href="#Apply-a-function-row-by-row">Apply a function row by row</a><a id="Apply-a-function-row-by-row-1"></a><a class="docs-heading-anchor-permalink" href="#Apply-a-function-row-by-row" title="Permalink"></a></h2><p>To apply a function row by row, use <code>map</code>: the first argument is the anonymous function, the second is the dataset.</p><pre><code class="language-julia hljs">speed = map(i -&gt; i.Distance / i.AirTime * 60, flights)</code></pre><pre><code class="nohighlight hljs">227496-element Array{Union{Missing, Float64},1}:
 336.0
 298.6666666666667
 280.0
 344.61538461538464
 305.45454545454544
 298.6666666666667
 312.55813953488376
 336.0
 327.8048780487805
 298.6666666666667
 320.0
 ⋮
 473.7931034482758
 479.30232558139534
 496.6265060240964
 468.59999999999997
 478.1632653061224
 483.0927835051546
 498.5106382978723
 445.57377049180326
 424.6875
 460.6779661016949</code></pre><h2 id="Add-new-variables"><a class="docs-heading-anchor" href="#Add-new-variables">Add new variables</a><a id="Add-new-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Add-new-variables" title="Permalink"></a></h2><p>Use the <code>transform</code> function to add a column to an existing dataset:</p><pre><code class="language-julia hljs">transform(flights, :Speed =&gt; speed)</code></pre><p>If you need to add the new column to the existing dataset:</p><pre><code class="language-julia hljs">flights = transform(flights, :Speed =&gt; speed)</code></pre><h2 id="Reduce-variables-to-values"><a class="docs-heading-anchor" href="#Reduce-variables-to-values">Reduce variables to values</a><a id="Reduce-variables-to-values-1"></a><a class="docs-heading-anchor-permalink" href="#Reduce-variables-to-values" title="Permalink"></a></h2><p>To get the average delay, we first filter away datapoints where <code>ArrDelay</code> is missing, then group by <code>:Dest</code>, select <code>:ArrDelay</code> and compute the mean:</p><pre><code class="language-julia hljs">using Statistics

groupby(mean ∘ skipmissing, flights, :Dest, select = :ArrDelay)</code></pre><pre><code class="nohighlight hljs">Table with 116 rows, 2 columns:
Dest   avg_delay
────────────────
&quot;ABQ&quot;  7.22626
&quot;AEX&quot;  5.83944
&quot;AGS&quot;  4.0
&quot;AMA&quot;  6.8401
&quot;ANC&quot;  26.0806
&quot;ASE&quot;  6.79464
&quot;ATL&quot;  8.23325
&quot;AUS&quot;  7.44872
&quot;AVL&quot;  9.97399
&quot;BFL&quot;  -13.1988
&quot;BHM&quot;  8.69583
&quot;BKG&quot;  -16.2336
⋮
&quot;SJU&quot;  11.5464
&quot;SLC&quot;  1.10485
&quot;SMF&quot;  4.66271
&quot;SNA&quot;  0.35801
&quot;STL&quot;  7.45488
&quot;TPA&quot;  4.88038
&quot;TUL&quot;  6.35171
&quot;TUS&quot;  7.80168
&quot;TYS&quot;  11.3659
&quot;VPS&quot;  12.4572
&quot;XNA&quot;  6.89628</code></pre><h2 id="Performance-tip"><a class="docs-heading-anchor" href="#Performance-tip">Performance tip</a><a id="Performance-tip-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-tip" title="Permalink"></a></h2><p>If you&#39;ll group often by the same variable, you can sort your data by that variable at once to optimize future computations.</p><pre><code class="language-julia hljs">sortedflights = reindex(flights, :Dest)</code></pre><pre><code class="nohighlight hljs">Table with 227496 rows, 22 columns:
Columns:
#   colname            type
────────────────────────────────────────────────────
1   Dest               String
2   Year               Int64
3   Month              Int64
4   DayofMonth         Int64
5   DayOfWeek          Int64
6   DepTime            DataValues.DataValue{Int64}
7   ArrTime            DataValues.DataValue{Int64}
8   UniqueCarrier      String
9   FlightNum          Int64
10  TailNum            String
11  ActualElapsedTime  DataValues.DataValue{Int64}
12  AirTime            DataValues.DataValue{Int64}
13  ArrDelay           DataValues.DataValue{Int64}
14  DepDelay           DataValues.DataValue{Int64}
15  Origin             String
16  Distance           Int64
17  TaxiIn             DataValues.DataValue{Int64}
18  TaxiOut            DataValues.DataValue{Int64}
19  Cancelled          Int64
20  CancellationCode   String
21  Diverted           Int64
22  Speed              DataValues.DataValue{Float64}</code></pre><pre><code class="language-julia hljs">using BenchmarkTools

println(&quot;Presorted timing:&quot;)
@benchmark groupby(mean ∘ skipmissing, sortedflights, select = :ArrDelay)</code></pre><pre><code class="nohighlight hljs">Presorted timing:

BenchmarkTools.Trial:
  memory estimate:  31.23 MiB
  allocs estimate:  1588558
  --------------
  minimum time:     39.565 ms (8.03% GC)
  median time:      44.401 ms (9.83% GC)
  mean time:        44.990 ms (10.36% GC)
  maximum time:     57.016 ms (15.96% GC)
  --------------
  samples:          112
  evals/sample:     1</code></pre><pre><code class="language-julia hljs">println(&quot;Non presorted timing:&quot;)
@benchmark groupby(mean ∘ skipmissing, flights, select = :ArrDelay)</code></pre><pre><code class="nohighlight hljs">Non presorted timing:

BenchmarkTools.Trial:
  memory estimate:  1.81 KiB
  allocs estimate:  30
  --------------
  minimum time:     195.095 μs (0.00% GC)
  median time:      212.309 μs (0.00% GC)
  mean time:        230.878 μs (0.20% GC)
  maximum time:     4.859 ms (95.04% GC)
  --------------
  samples:          10000
  evals/sample:     1</code></pre><p>Using <code>summarize</code>, we can summarize several columns at the same time:</p><pre><code class="language-julia hljs">summarize(mean ∘ skipmissing, flights, :Dest, select = (:Cancelled, :Diverted))

# For each carrier, calculate the minimum and maximum arrival and departure delays:

cols = Tuple(findall(i -&gt; occursin(&quot;Delay&quot;, string(i)), colnames(flights)))
summarize((min = minimum∘skipmissing, max = maximum∘skipmissing), flights, :UniqueCarrier, select = cols)</code></pre><pre><code class="nohighlight hljs">Table with 15 rows, 5 columns:
UniqueCarrier  ArrDelay_min  DepDelay_min  ArrDelay_max  DepDelay_max
─────────────────────────────────────────────────────────────────────
&quot;AA&quot;           -39           -15           978           970
&quot;AS&quot;           -43           -15           183           172
&quot;B6&quot;           -44           -14           335           310
&quot;CO&quot;           -55           -18           957           981
&quot;DL&quot;           -32           -17           701           730
&quot;EV&quot;           -40           -18           469           479
&quot;F9&quot;           -24           -15           277           275
&quot;FL&quot;           -30           -14           500           507
&quot;MQ&quot;           -38           -23           918           931
&quot;OO&quot;           -57           -33           380           360
&quot;UA&quot;           -47           -11           861           869
&quot;US&quot;           -42           -17           433           425
&quot;WN&quot;           -44           -10           499           548
&quot;XE&quot;           -70           -19           634           628
&quot;YV&quot;           -32           -11           72            54</code></pre><p>For each day of the year, count the total number of flights and sort in descending order:</p><pre><code class="language-julia hljs">Lazy.@as x flights begin
    groupby(length, x, :DayofMonth)
    sort(x, :length, rev = true)
end</code></pre><pre><code class="nohighlight hljs">Table with 31 rows, 2 columns:
DayofMonth  length
──────────────────
28          7777
27          7717
21          7698
14          7694
7           7621
18          7613
6           7606
20          7599
11          7578
13          7546
10          7541
17          7537
⋮
25          7406
16          7389
8           7366
12          7301
4           7297
19          7295
24          7234
5           7223
30          6728
29          6697
31          4339</code></pre><p>For each destination, count the total number of flights and the number of distinct planes that flew there</p><pre><code class="language-julia hljs">groupby((flight_count = length, plane_count = length∘union), flights, :Dest, select = :TailNum)</code></pre><pre><code class="nohighlight hljs">Table with 116 rows, 3 columns:
Dest   flight_count  plane_count
────────────────────────────────
&quot;ABQ&quot;  2812          716
&quot;AEX&quot;  724           215
&quot;AGS&quot;  1             1
&quot;AMA&quot;  1297          158
&quot;ANC&quot;  125           38
&quot;ASE&quot;  125           60
&quot;ATL&quot;  7886          983
&quot;AUS&quot;  5022          1015
&quot;AVL&quot;  350           142
&quot;BFL&quot;  504           70
&quot;BHM&quot;  2736          616
&quot;BKG&quot;  110           63
⋮
&quot;SJU&quot;  391           115
&quot;SLC&quot;  2033          368
&quot;SMF&quot;  1014          184
&quot;SNA&quot;  1661          67
&quot;STL&quot;  2509          788
&quot;TPA&quot;  3085          697
&quot;TUL&quot;  2924          771
&quot;TUS&quot;  1565          226
&quot;TYS&quot;  1210          227
&quot;VPS&quot;  880           224
&quot;XNA&quot;  1172          177</code></pre><h2 id="Window-functions"><a class="docs-heading-anchor" href="#Window-functions">Window functions</a><a id="Window-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Window-functions" title="Permalink"></a></h2><p>In the previous section, we always applied functions that reduced a table or vector to a single value. Window functions instead take a vector and return a vector of the same length, and can also be used to manipulate data. For example we can rank, within each <code>UniqueCarrier</code>, how much delay a given flight had and figure out the day and month with the two greatest delays:</p><pre><code class="language-julia hljs">using StatsBase
fc = dropmissing(flights, :DepDelay)
gfc = groupby(fc, :UniqueCarrier, select = (:Month, :DayofMonth, :DepDelay), flatten = true) do dd
    rks = ordinalrank(column(dd, :DepDelay), rev = true)
    sort(dd[rks .&lt;= 2], by =  i -&gt; i.DepDelay, rev = true)
end</code></pre><pre><code class="nohighlight hljs">Table with 30 rows, 4 columns:
UniqueCarrier  Month  DayofMonth  DepDelay
──────────────────────────────────────────
&quot;AA&quot;           12     12          970
&quot;AA&quot;           11     19          677
&quot;AS&quot;           2      28          172
&quot;AS&quot;           7      6           138
&quot;B6&quot;           10     29          310
&quot;B6&quot;           8      19          283
&quot;CO&quot;           8      1           981
&quot;CO&quot;           1      20          780
&quot;DL&quot;           10     25          730
&quot;DL&quot;           4      5           497
&quot;EV&quot;           6      25          479
&quot;EV&quot;           1      5           465
⋮
&quot;OO&quot;           4      4           343
&quot;UA&quot;           6      21          869
&quot;UA&quot;           9      18          588
&quot;US&quot;           4      19          425
&quot;US&quot;           8      26          277
&quot;WN&quot;           4      8           548
&quot;WN&quot;           9      29          503
&quot;XE&quot;           12     29          628
&quot;XE&quot;           12     29          511
&quot;YV&quot;           4      22          54
&quot;YV&quot;           4      30          46</code></pre><p>Though in this case, it would have been simpler to use Julia partial sorting:</p><pre><code class="language-julia hljs">groupby(fc, :UniqueCarrier, select = (:Month, :DayofMonth, :DepDelay), flatten = true) do dd
    partialsort(dd, 1:2, by = i -&gt; i.DepDelay, rev = true)
end</code></pre><pre><code class="nohighlight hljs">Table with 30 rows, 4 columns:
UniqueCarrier  Month  DayofMonth  DepDelay
──────────────────────────────────────────
&quot;AA&quot;           12     12          970
&quot;AA&quot;           11     19          677
&quot;AS&quot;           2      28          172
&quot;AS&quot;           7      6           138
&quot;B6&quot;           10     29          310
&quot;B6&quot;           8      19          283
&quot;CO&quot;           8      1           981
&quot;CO&quot;           1      20          780
&quot;DL&quot;           10     25          730
&quot;DL&quot;           4      5           497
&quot;EV&quot;           6      25          479
&quot;EV&quot;           1      5           465
⋮
&quot;OO&quot;           4      4           343
&quot;UA&quot;           6      21          869
&quot;UA&quot;           9      18          588
&quot;US&quot;           4      19          425
&quot;US&quot;           8      26          277
&quot;WN&quot;           4      8           548
&quot;WN&quot;           9      29          503
&quot;XE&quot;           12     29          628
&quot;XE&quot;           12     29          511
&quot;YV&quot;           4      22          54
&quot;YV&quot;           4      30          46</code></pre><p>For each month, calculate the number of flights and the change from the previous month</p><pre><code class="language-julia hljs">using ShiftedArrays
y = groupby(length, flights, :Month)
lengths = columns(y, :length)
transform(y, :change =&gt; lengths .- lag(lengths))</code></pre><pre><code class="nohighlight hljs">Table with 12 rows, 3 columns:
Month  length  change
─────────────────────
1      18910   missing
2      17128   -1782
3      19470   2342
4      18593   -877
5      19172   579
6      19600   428
7      20548   948
8      20176   -372
9      18065   -2111
10     18696   631
11     18021   -675
12     19117   1096</code></pre><h2 id="Visualizing-your-data"><a class="docs-heading-anchor" href="#Visualizing-your-data">Visualizing your data</a><a id="Visualizing-your-data-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-your-data" title="Permalink"></a></h2><p>The <a href="https://github.com/JuliaPlots/StatsPlots.jl">StatsPlots</a> and <a href="https://github.com/piever/GroupedErrors.jl">GroupedErrors</a> package as well as native plotting recipes from JuliaDB using <a href="https://github.com/joshday/OnlineStats.jl">OnlineStats</a> make a rich set of visualizations possible with an intuitive syntax.</p><p>Use the <code>@df</code> macro to be able to refer to columns simply by their name. You can work with these symobls as if they are regular vectors. Here for example, we split data according to whether the distance is smaller or bigger than <code>1000</code>.</p><pre><code class="language-julia hljs">using StatsPlots
gr(fmt = :png) # choose the fast GR backend and set format to png: svg would probably crash with so many points
@df flights scatter(:DepDelay, :ArrDelay, group = :Distance .&gt; 1000, layout = 2, legend = :topleft)</code></pre><p><img src="https://user-images.githubusercontent.com/6333339/40072129-b96c2b7a-586a-11e8-8f5d-4151dbc94345.png" alt="scatterflights"/></p><h2 id="Online-statistics"><a class="docs-heading-anchor" href="#Online-statistics">Online statistics</a><a id="Online-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Online-statistics" title="Permalink"></a></h2><p>For large datasets, summary statistics can be computed using efficient online algorithms implemnted in OnlineStats. Here we will use an online algorithm to compute the <code>mean</code> traveled distance split across month of the year.</p><pre><code class="language-julia hljs">using OnlineStats
grpred = groupreduce(Mean(), flights, :Month; select = :Distance)</code></pre><pre><code class="nohighlight hljs">Table with 12 rows, 2 columns:
Month  Mean
────────────────────────────────────
1      Mean: n=18910 | value=760.804
2      Mean: n=17128 | value=763.909
3      Mean: n=19470 | value=782.788
4      Mean: n=18593 | value=783.845
5      Mean: n=19172 | value=789.66
6      Mean: n=19600 | value=797.869
7      Mean: n=20548 | value=798.52
8      Mean: n=20176 | value=793.727
9      Mean: n=18065 | value=790.444
10     Mean: n=18696 | value=788.256
11     Mean: n=18021 | value=790.691
12     Mean: n=19117 | value=809.024</code></pre><p>Extract the values of the OnlineStat objects with the <code>value</code> function.</p><pre><code class="language-julia hljs">select(grpred, (:Month, :Mean =&gt; value))</code></pre><pre><code class="nohighlight hljs">Table with 12 rows, 2 columns:
Month  Mean
──────────────
1      760.804
2      763.909
3      782.788
4      783.845
5      789.66
6      797.869
7      798.52
8      793.727
9      790.444
10     788.256
11     790.691
12     809.024</code></pre><h2 id="Interfacing-with-online-datasets"><a class="docs-heading-anchor" href="#Interfacing-with-online-datasets">Interfacing with online datasets</a><a id="Interfacing-with-online-datasets-1"></a><a class="docs-heading-anchor-permalink" href="#Interfacing-with-online-datasets" title="Permalink"></a></h2><p>JuliaDB can also smoothly interface online datasets using packages from the <a href="https://github.com/JuliaDatabases">JuliaDatabases</a> organization. Here&#39;s how it would work with a MySQL dataset:</p><pre><code class="language-julia hljs">using MySQL, JuliaDB</code></pre><pre><code class="language-julia hljs">conn = MySQL.connect(host::String, user::String, passwd::String; db::String = &quot;&quot;) # edit as needed for your dataset
MySQL.query(conn, &quot;SELECT Name, Salary FROM Employee;&quot;) |&gt; table # execute the query and collect as a table
MySQL.disconnect(conn)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ml/">« Feature Extraction</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Tuesday 12 April 2022 06:00">Tuesday 12 April 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
